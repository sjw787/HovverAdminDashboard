SES ACCOUNT MIGRATION - QUICK START
====================================
Date: January 17, 2026

PROBLEM
-------
SES was set up in the wrong AWS account (777653593792 - iamadmin-general)
It needs to be in account 052869941234 (iamadmin-dev) where Cognito/S3/ECS are located.

SOLUTION - TWO SIMPLE STEPS
----------------------------

STEP 1: Run the migration script
---------------------------------
  .\migrate-ses-complete.ps1

This will:
- Check which account you're in
- Delete SES from iamadmin-general (if you're in that account)
- Guide you to switch to iamadmin-dev
- Setup SES in iamadmin-dev (when you're in the right account)

STEP 2: Wait and verify
------------------------
After setup completes:
1. Wait 5-30 minutes for DNS verification
2. Check status: python setup_ses.py --check-status samwylock.com
3. Configure Cognito to use SES (see below)


DETAILED STEPS (if needed)
---------------------------

If you're currently in iamadmin-general (777653593792):

1. Delete SES from wrong account:
   python migrate_ses_account.py

2. Switch to iamadmin-dev account (052869941234):

   Option A - If you have iamadmin-dev profile:
     $env:AWS_PROFILE="iamadmin-dev"
     Remove-Item Env:AWS_ACCESS_KEY_ID -ErrorAction SilentlyContinue
     Remove-Item Env:AWS_SECRET_ACCESS_KEY -ErrorAction SilentlyContinue

   Option B - Configure new profile:
     aws configure --profile iamadmin-dev
     # Enter credentials for account 052869941234
     $env:AWS_PROFILE="iamadmin-dev"

   Option C - Use environment variables:
     $env:AWS_ACCESS_KEY_ID="<your-access-key>"
     $env:AWS_SECRET_ACCESS_KEY="<your-secret-key>"
     Remove-Item Env:AWS_PROFILE -ErrorAction SilentlyContinue

3. Verify you're in the correct account:
   python check_ses_account.py
   # Should show: Account ID: 052869941234

4. Setup SES in iamadmin-dev:
   python migrate_ses_account.py --setup-only

5. Wait for DNS verification (5-30 minutes):
   python setup_ses.py --check-status samwylock.com

6. If DKIM tokens changed, update Route53:
   .\setup_dns.ps1 -Domain "samwylock.com" -Route53


CONFIGURE COGNITO TO USE SES
-----------------------------
Once SES is verified in iamadmin-dev:

Via AWS Console:
1. Go to Cognito > User Pools > us-east-1_vqzmBxIoP
2. Navigate to: Messaging > Email
3. Change from "Cognito defaults" to "Send email with Amazon SES"
4. Set FROM address: noreply@samwylock.com
5. Save changes

Via AWS CLI:
  aws cognito-idp update-user-pool \
    --user-pool-id us-east-1_vqzmBxIoP \
    --email-configuration \
      SourceArn=arn:aws:ses:us-east-1:052869941234:identity/samwylock.com,\
      EmailSendingAccount=DEVELOPER,\
      From=noreply@samwylock.com \
    --region us-east-1


TEST EMAIL SENDING
------------------
After Cognito is configured, test by creating a new customer:
1. Use the admin dashboard to create a test customer
2. Customer should receive welcome email from noreply@samwylock.com
3. Check email delivery in SES Console > Email sending > Dashboard


AVAILABLE SCRIPTS
-----------------
- migrate-ses-complete.ps1 - Full migration automation (recommended)
- check-aws-account.ps1 - Check which account you're using
- migrate_ses_account.py - Manual migration control
- setup_ses.py - SES domain registration
- setup_dns.ps1 - DNS record management
- verify-ses-status.ps1 - Check SES verification status


INFRASTRUCTURE SUMMARY
----------------------
Account 777653593792 (iamadmin-general):
- [DELETE] SES domain configuration

Account 052869941234 (iamadmin-dev):
- [SETUP] SES domain: samwylock.com
- Cognito User Pool: us-east-1_vqzmBxIoP
- S3 Bucket: hovver-images-dev
- ECS Cluster: hovver-admin-cluster
- ECR: 052869941234.dkr.ecr.us-east-1.amazonaws.com/hovver-admin-app

Account admin-legacy:
- Route53 Hosted Zone: Z0463989E6ZRMK2X7OOO
- DNS records for SES (already configured, no changes needed)
- ACM Certificate: *.samwylock.com


TROUBLESHOOTING
---------------
Q: Script says "already in target account" but I see wrong account number
A: Check which credentials are being used:
   - Check: aws sts get-caller-identity
   - Clear: Remove-Item Env:AWS_* -ErrorAction SilentlyContinue
   - Set profile: $env:AWS_PROFILE="iamadmin-dev"

Q: DKIM verification fails after migration
A: DKIM tokens may have changed. Update DNS:
   .\setup_dns.ps1 -Domain "samwylock.com" -Route53

Q: Can't find iamadmin-dev profile
A: Create it:
   aws configure --profile iamadmin-dev
   # Enter access key and secret for account 052869941234

Q: Cognito still sending from default email
A: Update Cognito email configuration (see section above)


QUICK VERIFICATION CHECKLIST
-----------------------------
[ ] SES deleted from account 777653593792
[ ] Switched to account 052869941234
[ ] SES domain registered in 052869941234
[ ] Domain verification: Success
[ ] DKIM verification: Success
[ ] DNS records correct in Route53
[ ] Cognito configured to use SES
[ ] Test email sent successfully


FOR MORE DETAILS
----------------
See: SES_ACCOUNT_MIGRATION_GUIDE.txt
